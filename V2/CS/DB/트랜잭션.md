# 트랜잭션에 대한 모든 것

### 순서
1. 트랜잭션이 뭔가요?
2. 트랜잭션이 필요한 이유
3. 트랜잭션의 특징 - ACID
4. 트랜잭션의 진행 상태
5. 트랜잭션 연산
6. DBMS의 구조
6. 원자성 - 트랜잭션 처리 도중 실패 시에는 어떻게?
    - 회복 => UNDO(롤백과 같다고 볼 수 있음), REDO, Check Point
7. Lock
8. 트랜잭션 처리시 주의할 점
    - 교착상태
9. 격리성 - 트랜잭션의 고립 수준
    - 무조건 수많은 트랜잭션을 순서대로 처리하면 성능이 떨어짐 - 효율적인 Locking을 이용
        - 공유 Lock, 베타 Lock
    - 레벨 0 => Read Uncommitted
    - 레벨 1 => Read Committed
    - 레벨 2 => Repeatable Read
    - 레벨 3 => Serialized Read
10. 격리성 - 트랜잭션의 고립 수준 선택 시 고려사항
    - 동시성과 무결성과 관련되어있음.
    - 동시성을 증가시키면 무결성에 문제가 생기고 그 역의 상황도 발생함.
11. 격리성 - 트랜잭션 고립수준을 낮게 잡는다면 일어나는 현상
    - Dirty Read
    - Non-Repeatable Read
    - Phantom Read
12. 트랜잭션 처리동안 시간이 오래 걸린다. API요청이 오면 어떻게 해결 가능할까?
    - 클라가 비동기 통신을 하면됨


### **트랜잭션이란?**  
데이터베이스의 상태를 변화시키는 *논리적 기능을 수행하기 위한 작업의 단위*  
> 함께 이루어지는 작업들의 제어 및 실패 시 회복 작업을 함  


### **트랜잭션이 필요한 이유**  
- 데이터의 일관성을 유지하면서 안정적으로 데이터를 복구하기 위함.
- ex) 은행의 송금 시스템
    - A계좌에서는 돈이 빠져나가고 B계좌에서는 돈이 들어와야함.
    - 빠져나가고 들어오는 것을 한번에 처리
    - 오류가 나면 안정적으로 되돌려야함.  


### **트랜잭션의 특징**  
- **Atomicity(원자성)**
    - 트랜잭셔이 모두 반영되던가 반영되지 않던가
- **Consistency(일관성)**
    - 트랜잭션 처리 결과가 항상 동일 해야함
    - 어떤 쿼리에서는 다른 값을 내뿜으면 안됨
- **Isolation(독립성 or 고립성 or 격리성)**
    - 트랜잭션이 병행 실행되고 있을때 두 연산의 서로 끼어들 수 없다.
- **Durabilty(영구성)**
    - 트랜잭션이 성공적으로 완료되면 결과는 영구적으로 반영되어야 함.  


### **트랜잭션의 진행 상태**
1. Active(활동) - 실행중인 상태, 연산들이 정상적으로 실행 중
2. Failed(실패) - 실행에 오류가 발생하여 중단
3. Aborted(철회) - 비정상적으로 종료되어 Rollback 연산을 수행한 상태
4. Partially Committed(부분적 완료) - 아직 작성한 것들을 저장하지 않은 상태
5. Committed(완료) - 성공적으로 종료되어 Commit 연산을 실행한 후의 상태  


### **DBMS의 구조**  
DMBS - 질의 처리기, 저장 시스템으로 나뉨.  
DB - 하드디스크(파일, 인덱스, 통계 등)

- 고정 길이의 페이지 단위로 디스크를 읽고 씀.
- 저장 공간은 디스크로 일부는 MainMemory에 저장
- 버퍼관리 정책
    - 저장 시스템에 속하는 모듈 - Main Memory에 유지하는 페이지를 관리하는 모듈
    - 일종의 캐시느낌.  


### **트랜잭션 연산**  
DML(INSERT, UPDATE), DDL(CREATE, ALTER, DROP), DCL(GRANT, REVOKE) 문장이 실행됐을 때 트랜잭션 시작  
DDL, DCL은 트랜잭션이 자동으로 종료  
DML 같은 경우 Commit, Rollback으로 종료해야함.  
1. **Commit**
    - 하나의 트랜잭션이 성공적으로 끝남, DB가 일관된 상태일 때 연산 완료를 알려주기 위한 연산
2. **Rollback**
    - 하나의 트랜잭션 처리가 비정상적으로 종료되어 일관성을 깨뜨리면, 행한 모든 연산을 취소하는 연산(Undo)
    - 트랜잭션 내에서 에러 -> Rollback
    - 시스템 오류같은 외부 요인 -> 회복  


### **원자성 - 회복방법**  
시스템 오류와 같은 외부 요인으로 에러가 발생했을 때 회복.
1. **Undo**
    - 원상태로 되돌림
    - 사용자가 했던 작업을 반대로 진행해 원상태로 되돌림
2. **Redo**
    - 이미 commit한 수정을 재반영하는 복구
    - 이전 상태로 되돌리고 실패가 발생하기 전까지의 과정을 그대로 따라감
    - 그러기 위해 과정을 기록해야함 - log
3. **Check Point**
    - 설정한 지점 이전까지는 트랜잭션이 성공적으로 수행 -> disk에 확실히 저장된 상태  
    - 회복하기 위해 돌아갈 때, 너무 많이 돌아가지 않도록 하기 위함  


## **Lock**  



### **트랜잭션 교착상태(데드락)**
여러개의 트랜잭션이 실행을 하지 못하고 무한정 기다리는 상태  
- 트랜잭션들의 동시성을 제어하기 위해 `Locking(로킹)`을 사용
- 그 부작용으로 