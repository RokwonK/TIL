---
title: 람다에 대해 알아보자
author: 김록원
date: 2022.12.13
category: serverless
---

### 목차
- [서버리스란](#서버리스란)
  - [서버리스의 종류](#서버리스-종류)
  - [그래서 람다란?](#그래서-람다는)
- [람다의 특징](#람다의-특징)
  - [람다 실행하기](#람다-실행하기)
  - [장점](#장점)
  - [단점](#단점)
- [람다 효율을 위한 학장 기능](#람다의-효율을-위한-확장-기능)
  - [람다 레이어](#람다-레이어)
  - [프로비저닝 컨커런시](#프로비저닝-컨커런시)
  - [스텝 펑션](#스텝-펑션)
  - [RDS 프록시](#rds-프록시)
  - [서버리스 프레임워크](#serverless-framework)
  - [람다 엣지](#람다-엣지)

<br />

# 람다에 대해 알아보자
이제는 람다라는 이름이 익숙하게 들려온다. 그만큼이나 여러곳에서 유용하게 쓰이고 있다고 생각한다.  
실제로 람다를 이용해 API 서버도 만들어 운영해보았지만 지식이 제대로 정리가 되어 있지 않아 이번 기회에 정리해본다.
서버리스에 대한 이해, 람다의 특장단점, 간단한 람다의 동작방식과 람다의 단점을 해결하기 위해 나온 확장기능도 훑어보자.

<br />

## 서버리스란
람다는 서버리스 컴퓨팅 서비스이다. 서버리스란 뭘까?  
서버리스란 **개발자가 서버를 관리할 필요없이 클라우드에게 서버 관리를 맡기는 것**이다. 이로 인해 개발자는 서버관리에 시간을 쏟지 않고 코드에만 집중할 수 있게된다.

<br />  

### 서버리스 종류
서버리스는 개발자가 서버를 관리하지 않을 뿐 결국 클라우드 서비스가 처리하는 서버를 관리한다.  
서버리스 컴퓨팅 기술은 클라우드가 어떤 방식으로 관리를 하는지를 기준으로 BaaS와 FaaS로 나눌 수 있다.  

> **💡 BaaS(Backend as a Service)**
보통의 서버 개발을 할때 서버뿐만이 아니라 데이터 저장을 위한 데이터베이스, 유저인증기술, 이미지를 저장할 공간 등도 함께 구성해야한다.  
BaaS는 위처럼 서버 개발에 필요한 데이터베이스, SNS로그인 연동, 객체 저장소 등을 자체 API로 제공을 해주는 서비스이다. 대표적으로 Firebase와 같은 서비스가 있다.  


> **💡 FaaS(Function as a Servcie)**  
프로그래밍에서 사용하는 메서드와 같이 함수를 서비스로 제공하는 것을 말한다.  
다시 말해 **실행가능한 코드 덩어리 자체가 서비스**이다.  
어떠한 이벤트를 받게 되면 등록된 함수를 실행하는 구조이다.  
AWS의 람다와 구글의 클라우드 펑션 등이 있다.  

<br />

### 그래서 람다는?
위에서 보았듯이 람다는 AWS가 제공하는 FaaS 서버리스 기술이다.  
여러가지 함수들을 등록할 수 있으며 특정 이벤트로 인해 각각의 함수들이 실행된다.  
현재는 Go, Java, JavaScript, Python, Ruby 등 다수의 언어로 람다함수를 만들 수 있다.  

<br /><hr><br />

## 람다의 특징

### 람다 실행하기
람다는 이벤트를 기반하여 즉시 실행된다. 곧바로 람다를 실행시킬 수도 혹은 이벤트를 구독하여 비동기적으로 람다를 실행시킬수도 있다. 대표적으로 아래와 같은 방법으로 lambda 함수를 사용한다.

![withLambda](https://user-images.githubusercontent.com/52196792/208036622-32da0aa3-59ca-49a7-a755-00b449e54e3d.png)

- CloudWatch + Lambda
  - AWS CloudWatch에 로그이벤트(특정 패턴 등록도 가능)에 대응
- S3 + Lambda
  - AWS S3의 특정이벤트(이미지 업로드 등)에 대응
- API Gateway + Lambda
  - AWS API Gateway로 들어오는 HTTP 요청을 람다 함수를 사용해 응답처리
- SQS + Lambda
  - AWS SQS 등으로 들어온 이벤트를 확인 후 비동기로 람다 함수를 이용해 작업처리

<br />

### 장점
- 사용한 만큼만 돈을 냄(비용 절감)
  - 지속적으로 돌아가는 서버에 비해 사용할때만 실행하는 람다는 실행횟수에 비례하여 비용을 청구
  - 100만번 실행당 0.2달러로 매우 쌈
- 자동 스케일업, 높은 가용성
  - 요청이 들어올때 동적으로 자원을 할당하고 스케일링을 처리함
  - 많은 요청이 들어오면 그만큼 요금이 더 청구되기도 함
- 빠른 제품 출시
  - 서버 관리에 신경쓸 필요없이 코드에만 집중할 수 있음
- CloudWatch와의 모니터링 통합도 쉬움
- 함수당 최대 10GB의 RAM을 프로비저닝할 수 있다.
  - RAM이 증가하면 CPU와 네트워크 성능도 함께 향상됨  


<br />

### 단점
- cold start(람다가 깰때 걸리는 시간)
  - 람다는 평소에 잠자고 있다 실행될때 깨서 일을 처리함.
  - 이때 지연시간이 최대 1초까지 발생함
  - 지연이 허용되지 않는 서비스일 경우(실시간 서비스) 적합하지 않음
- 서버 제공자(aws, google 등)에 의존 
  - 플랫폼에 의존하기 때문에 플랫폼을 옮겨기 쉽지 않음.
- 긴 시간을 소요하는 작업에 불리(동영상 업로드)
  - 람다함수 호출 시 사용할 수 있는 메모리 및 시간에 제한이 있음.
  - 큰 기능이라면 잘게 나누어 구현해야함
- 코드 재사용이 어려움
  - 각 함수가 독립적이기 때문에 공통으로 사용하는 로직도 중복해서 작성하게 됨  

<br />  

### 한도(Region 당)
- 실행 한도
  - 메모리(RAM) 할당량은 128MB ~ 10GB(1MB 씩 증가)
  - 900초(15분) 실행이 한계
  - 환경변수는 4KB
  - 큰 파일을 불러올때 사용하는 임시공간 존재(/tmp 폴더) 최대 10GB
  - 최대 1000개까지 동시 실행 가능(자동 증가하긴 하지만 미리 설정해주면 좋음)
- 배포 한도
  - 압축(zip)시 최대한도는 50MB, 압축하지 않았을때 250MB
  - 환경변수는 4KB  

<br />  

### Lambda in VPC
기본적으로 Lambda는 VPC 외부에 있어 VPC 내부 리소스에 접근이 불가능하다.  
이를 해결하기 위해 Lambda를 VPC 내부에 둔다.  
1. VPC ID와 Subnet, Security Group을 설정해준다.  
2. Lambda가 Subnet에 ENI를 만든다.
3. 내부 리소스에 접근할 수 있다.  


<br /><hr><br />

## 람다의 효율을 위한 확장 기능
위에서 보았듯 람다는 cold start로 인한 지연문제, 서버 제공자에 대한 의존 문제 등 몇몇가지 고질적인 문제를 가지고 있다. 하지만 역시 이러한 문제들을 해소하기 위해 여러기술들이 나왔다. 뿐만 아니라 람다를 더 편리하게 개발하고 활용한 기술들도 등장하였다.

<br />

### Lambda Container Image  
- 컨테이너 이미지가 Lambda Runtime API를 구현해야 한다.  
  - 아무 이미지나 실행되지는 않는다는 의미
  - 컨테이너 이미지를 만들때의 전제 조건임(만약 구현하지 않는다면 ECS나 Fargate 이용하시길)

<br />

### 람다 레이어
위에서 살펴본 단점 중 코드 재사용이 어렵다는 문제가 있다. 이를 해소하기 위한 기술이다.  
공통된 부분을 레이어로 만들고 람다 함수들이 이를 공유해서 사용할 수 있다.  
같은 계정뿐 아니라 다른 계정들 사이에서도 서로 공유할 수 있다.  

[람다 레이어 살펴보기](https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/configuration-layers.html)

<br />

### 프로비저닝 컨커런시
람다의 cold start의 문제점을 해소하기 위한 기술이다.  
미리 람다함수를 실행할 수 있도록 준비해두는 기술로 동시 호출과 지연시간이 중요할 경우 사용할 수 있다.  

<br />

### 스텝 펑션  
람다 함수들을 조합해서 하나의 워크플로우를 구성할 수 있는 기술이다.  
SNS, SQS, 다이나모 DB 등 여러 서비스와 통합해서 사용할 수 있다.  

<br />

### RDS 프록시
RDS 데이터베이스 사이에서 커넥션을 관리해준다.  
서버의 경우 커넥션의 수를 자체적으로 관리하지만 람다의 경우는 그렇지 않다.  
이를 위해 RDS와 람다 사이에 RDS 프로시를 두고 RDS 프록시로 커넥션을 관리한다.  
- DB 연결을 풀링, 공유함으로써 확장성을 향상시킨다
- 장애 발생시 조치시간을 66%까지 줄여 가용성 향상 및 연결을 보존 시켜준다
- RDS 프로시 수준에서 IAM 인증을 강제하여 보안을 높일 수 있고 자격 증명은 Secret Manager에 저장된다.

<br />

### Serverless Framework
람다 설정, 배포 등의 작업을 할때 일일이 AWS 콘솔로 업로드하기에는 힘들다.  
코드로 명시하고 명령어로 작업할 수 있도록 도와주는 IaC(Infrastructure as Code) 도구이다.  
AWS SAM과 같은 도구들도 있다.  

[서버리스 프레임워크 살펴보기](https://www.serverless.com/)

<br />

### 람다 엣지
보통 함수와 어플은 특정 리전에 배포하지만 엣지 로케이션에 로직 처리를 처리할 수 있도록 해주는 것이 Lambda@Edge(Cloudfront Fuctions도 있음)  
초당 수천개의 요청을 처리할 수 있으며, 모든 Cloudfront 이벤트에서 사용할 수 있다.  
us-east-1에 작성 해야하고 연결시 Cloudfront가 모든 로케이션에 해당 함수를 복제한다. 최대 실행시간은 5~10 초이며 네트워크 혹은 파일 시스템의 접근이 허용된다.  

웹사이트보안, SEO, 사용자 보안, 사용자 우선순위 지정, 이미지 변환 등 조금의 지연시간이 있을때 유용하게 사용할 수 있다.  

<br />  

> CloudFront Functions  
js로 쓰는 가벼운 함수로 지연시간에 민감한 부분에서 많이 사용한다.  
고성능, 고확장성이 필요할때 사용한다.  
Cloudfront 이벤트 중 Viewer Request와 Viewer Response에서만 사용가능하다  
최대 실행 시간은 1밀리초 미만이면 초당 백만개의 요청을 처리한다.  
최적 캐시 키 생성, 헤더 조작, URL 리디렉션, 요청 인증/권한부여(JWT 등) 등에 사용할 수 있다.


<br /><hr><br /> 

## 참고자료
- [람다란](https://www.44bits.io/ko/keyword/aws-lambda)
- [서버리스 개념정리](https://inpa.tistory.com/entry/WEB-%F0%9F%8C%90-%EC%84%9C%EB%B2%84%EB%A6%AC%EC%8A%A4ServerLess-%EA%B0%9C%EB%85%90-%F0%9F%92%AF-%EC%B4%9D%EC%A0%95%EB%A6%AC-BaaS-FaaS)